---
title: simple way to make h.264 mp4 web and iOS/mobile playable video mp4 files for linux and macosx using ffmpeg
author: tracey pooh
type: post
date: 2013-02-10T05:10:48+00:00

categories:
  - linux
  - video
tags:
  - coding
  - ffmpeg
  - geek
  - h.264
  - Internet Archive
  - video
  - x264

---
Greetings video geeks! ðŸ˜Ž

At my job, I&#8217;ve updated the process and way we create our .mp4 files that are shown on video pages on archive.org

It&#8217;s a much cleaner/clearer process, namely:

  * I opted to **ditch ffpreset files in favor of command-line argument** 100% equivalents. It seems a bit easier for someone reading the task log of their item, trying to see what we did.
  * I **no longer need qt-faststart** step and dropped it. I use the cmd-line modern ffmpeg &#8220;-movflags faststart&#8221;

Entire processing is now done 100% with ffmpeg, in the standard &#8220;2-pass&#8221; mode
  
As before, this output .mp4:

  * **plays in** modern html5 video tag compatible **browsers**
  * **plays in flash** plugin within browsers
  * works on all **iOS devices**
  * makes sure the &#8220;moov atom&#8221; is at the front of the file, so browsers can **playback before downloading** the entire file, etc.

<span style="font-size: 16px;">Here is an example (you would tailor especially the &#8220;scale=640:480&#8221; depending on source aspect ratio and desired output size; change or drop altogether the &#8220;-r 20&#8221; option (the source was 20 fps, so we make the dest 20 fps); tailor the bitrate args to taste):</span>

  * ffmpeg -y -i stairs.avi -vcodec libx264 -pix\_fmt yuv420p -vf yadif,scale=640:480 -profile:v baseline -x264opts cabac=0:bframes=0:ref=1:weightp=0:level=30:bitrate=700:vbv\_maxrate=768:vbv_bufsize=1400 -movflags faststart -ac 2 -b:a 128k -ar 44100 -r 20 -pass 1 -acodec aac -strict experimental stairs.mp4;
  * ffmpeg -y -i stairs.avi -vcodec libx264 -pix\_fmt yuv420p -vf yadif,scale=640:480 -profile:v baseline -x264opts cabac=0:bframes=0:ref=1:weightp=0:level=30:bitrate=700:vbv\_maxrate=768:vbv_bufsize=1400 -movflags faststart -ac 2 -b:a 128k -ar 44100 -r 20 -pass 2 -acodec aac -strict experimental -metadata title='&#8221;Stairs where i work&#8221; &#8211; lame test item, bear with us &#8211; https://archive.org/details/stairs&#8217; -metadata year=&#8217;2004&#8242; -metadata comment=license:&#8217;http://creativecommons.org/licenses/publicdomain/&#8217; stairs.mp4;

 <em id="__mceDel">Happy hacking and creating!</em>

PS: here is the [way we compile ffmpeg][1] (we use ubuntu linux at work, but this script works on macosx, too).

 [1]: https://archive.org/~tracey/downloads/ffmpeg-README.txt